{% extends 'base.html.twig' %}

{% block title %}Connexion — Art Connect{% endblock %}

{% block guest_wrapper_open %}{% endblock %}
{% block guest_wrapper_close %}{% endblock %}

{% block body %}
{% include 'security/_auth_styles.html.twig' %}

<div class="auth-page">
    <div class="auth-card narrow">
        <div class="auth-brand">
            <i class="fas fa-palette"></i><span>Art Connect</span>
        </div>

        <p class="auth-sub">Connectez-vous à votre espace</p>

        <a href="#" class="btn-social" onclick="return false;">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
            Continuer avec Google
        </a>

        <div class="auth-divider">ou</div>

        <form method="post" novalidate>
            <div class="af">
                <label for="inputEmail">Email</label>
                <div class="af-wrap">
                    <i class="fas fa-envelope af-icon"></i>
                    <input type="email" value="{{ last_username }}" name="_username" id="inputEmail"
                           class="form-control" autocomplete="email" autofocus placeholder="votre@email.com">
                </div>
            </div>

            <div class="af">
                <label for="inputPassword">Mot de passe</label>
                <div class="af-wrap">
                    <i class="fas fa-lock af-icon"></i>
                    <input type="password" name="_password" id="inputPassword"
                           class="form-control" autocomplete="current-password" placeholder="Votre mot de passe">
                </div>
                <div class="text-end mt-1">
                    <a href="{{ path('app_forgot_password') }}" class="auth-link">Mot de passe oublié ?</a>
                </div>
            </div>

            <input type="hidden" name="_csrf_token" value="{{ csrf_token('authenticate') }}">

            <button type="submit" class="btn-auth mt-1">Se connecter</button>
        </form>

        {% if error %}
            {% set errMsg = error.messageKey|trans(error.messageData, 'security') %}
            {% if 'vérifier votre adresse email' in errMsg|lower %}
                <div class="text-center mt-2">
                    <a href="{{ path('app_registration_confirmation', {email: last_username}) }}" class="auth-link">
                        <i class="fas fa-redo me-1"></i>Renvoyer le lien de vérification
                    </a>
                </div>
            {% endif %}
        {% endif %}

        <div class="auth-footer">
            Pas encore de compte ? <a href="{{ path('register') }}">Créer un compte</a>
        </div>
    </div>
</div>

{% if error %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var c = document.getElementById('toast-container');
        if (!c) return;
        var t = document.createElement('div');
        t.className = 'ac-toast ac-toast-danger';
        t.setAttribute('role', 'alert');
        t.innerHTML = '<div class="ac-toast-icon"><i class="fas fa-exclamation-circle"></i></div>'
            + '<div class="ac-toast-body">{{ errMsg|e('js') }}</div>'
            + '<button class="ac-toast-close" onclick="this.parentElement.remove()"><i class="fas fa-times"></i></button>'
            + '<div class="ac-toast-progress"></div>';
        c.appendChild(t);
        setTimeout(function(){ t.style.animation='toastOut .3s ease-in forwards'; setTimeout(function(){t.remove();},300); }, 5000);
    });
</script>
{% endif %}
{% endblock %}
