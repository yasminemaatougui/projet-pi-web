<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>{% block title %}Plateforme de R√©servation{% endblock %}</title>
        <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%221.2em%22 font-size=%2296%22>üé®</text></svg>">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&family=Sora:wght@500;600;700&display=swap" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

        <style>
            :root {
                --ac-deep: #1E0F75;
                --ac-mid: #1C1DAB;
                --ac-blue: #3785D8;
                --ac-lavender: #BF8CE1;
                --ac-sky: #ADC6E5;
                --ac-pink: #EBB2C3;
            }

            body { min-height: 100vh; display: flex; flex-direction: column; font-family: 'Manrope', sans-serif; }

            /* ===== BACKOFFICE (Admin) ===== */
            .bo-wrapper { display: flex; width: 100%; flex: 1; }

            #sidebar {
                min-width: fit-content;
                background: linear-gradient(180deg, var(--ac-deep) 0%, var(--ac-mid) 100%);
                color: #fff;
                transition: all 0.3s;
                display: flex;
                flex-direction: column;
                height: 100vh;
                position: sticky;
                top: 0;
            }
            #sidebar .sidebar-header {
                padding: 15px 20px;
                background: rgba(30, 15, 117, 0.75);
                display: flex;
                align-items: center;
                gap: 10px;
            }
            #sidebar .sidebar-header h3 { margin: 0; color: #fff; }
            #sidebar .sidebar-header img { max-width: 100%; height: 35px; width: 35px; border-radius: 50%; }
            #sidebar ul.components { padding: 20px 0; border-bottom: 1px solid rgba(203,216,232,0.55); overflow-y: auto; flex-grow: 1; }
            #sidebar ul p { color: #fff; padding: 10px; }
            #sidebar ul li a { padding: 15px 20px; font-size: 1.1em; display: block; color: rgba(255,255,255,0.8); text-decoration: none; }
            #sidebar ul li a:hover { color: #fff; background: rgba(173,198,229,0.26); }
            #sidebar ul li.active > a { color: #fff; background: rgba(191,140,225,0.35); }

            .bo-content {
                width: 100%;
                padding: 20px;
                background: linear-gradient(180deg, #CBD8E8 0%, #ffffff 100%);
            }

            #sidebar ul.components::-webkit-scrollbar { width: 6px; }
            #sidebar ul.components::-webkit-scrollbar-track { background: var(--ac-mid); }
            #sidebar ul.components::-webkit-scrollbar-thumb { background: var(--ac-sky); border-radius: 3px; }
            #sidebar ul.components::-webkit-scrollbar-thumb:hover { background: var(--ac-lavender); }

            @media (max-width: 768px) {
                #sidebar { margin-left: -250px; }
                #sidebar.active { margin-left: 0; }
            }

            /* ===== ADMIN LIST (shared) ===== */
            .bo-page-header { display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:.75rem; margin-bottom:1.25rem; }
            .bo-page-header h1 { font-family:'Sora',sans-serif; font-weight:700; font-size:1.4rem; color:var(--ac-deep); margin:0; display:flex; align-items:center; gap:.6rem; }
            .bo-page-header h1 .badge { font-size:.7rem; padding:.35em .65em; vertical-align:middle; }
            .bo-page-header .bo-actions { display:flex; gap:.5rem; }
            .bo-page-header .bo-actions .btn { border-radius:10px; font-size:.84rem; font-weight:600; padding:.45rem 1rem; }

            .bo-filter-bar { background:#fff; border-radius:14px; padding:1rem 1.25rem; margin-bottom:1.25rem; box-shadow:0 2px 10px rgba(0,0,0,.04); border:1px solid #e9ecef; }
            .bo-filter-bar .form-control,
            .bo-filter-bar .form-select { border-radius:8px; font-size:.85rem; border:1.5px solid #e5e7eb; padding:.4rem .75rem; background:#f9fafb; }
            .bo-filter-bar .form-control:focus,
            .bo-filter-bar .form-select:focus { border-color:var(--ac-blue); box-shadow:0 0 0 3px rgba(55,133,216,.1); background:#fff; }
            .bo-filter-bar label { font-size:.78rem; font-weight:600; color:#6b7280; margin-bottom:.2rem; }
            .bo-filter-bar .btn { border-radius:8px; font-size:.84rem; font-weight:600; }

            .bo-table-card { background:#fff; border-radius:14px; overflow:hidden; box-shadow:0 2px 10px rgba(0,0,0,.04); border:1px solid #e9ecef; }
            .bo-table { margin:0; font-size:.88rem; }
            .bo-table thead { background:#f8f9fb; }
            .bo-table thead th { font-weight:700; font-size:.78rem; text-transform:uppercase; letter-spacing:.04em; color:#6b7280; padding:.7rem 1rem; border-bottom:2px solid #e9ecef; white-space:nowrap; }
            .bo-table tbody td { padding:.65rem 1rem; vertical-align:middle; color:#374151; border-bottom:1px solid #f3f4f6; }
            .bo-table tbody tr { transition:background .15s; }
            .bo-table tbody tr:hover { background:#f8f9ff; }
            .bo-table tbody tr:last-child td { border-bottom:none; }
            .bo-table .badge { font-size:.73rem; font-weight:600; padding:.3em .6em; border-radius:6px; }
            .bo-table .btn-action { width:30px; height:30px; padding:0; border-radius:8px; display:inline-flex; align-items:center; justify-content:center; font-size:.78rem; border:none; transition:all .2s; }
            .bo-table .btn-view { background:rgba(55,133,216,.1); color:var(--ac-blue); }
            .bo-table .btn-view:hover { background:var(--ac-blue); color:#fff; }
            .bo-table .btn-edit { background:rgba(245,158,11,.1); color:#f59e0b; }
            .bo-table .btn-edit:hover { background:#f59e0b; color:#fff; }
            .bo-table .btn-del { background:rgba(239,68,68,.1); color:#ef4444; }
            .bo-table .btn-del:hover { background:#ef4444; color:#fff; }
            .bo-table .btn-ok { background:rgba(34,197,94,.1); color:#22c55e; }
            .bo-table .btn-ok:hover { background:#22c55e; color:#fff; }

            .bo-pagination { display:flex; justify-content:space-between; align-items:center; padding:1rem 1.25rem; flex-wrap:wrap; gap:.5rem; }
            .bo-pagination .page-info { font-size:.82rem; color:#6b7280; }
            .bo-pagination .pagination { margin:0; gap:3px; }
            .bo-pagination .page-link { border-radius:8px; font-size:.82rem; font-weight:600; padding:.3rem .6rem; border:1.5px solid #e5e7eb; color:#374151; }
            .bo-pagination .page-item.active .page-link { background:var(--ac-mid); border-color:var(--ac-mid); color:#fff; }
            .bo-pagination .page-link:hover { background:#f3f4f6; }
            .bo-pagination .page-item.disabled .page-link { color:#d1d5db; }

            .bo-empty { text-align:center; padding:3rem 1rem; color:#9ca3af; }
            .bo-empty i { font-size:2rem; margin-bottom:.5rem; display:block; }

            /* ===== FRONTOFFICE (Artist / Participant) ===== */
            .fo-navbar {
                background: linear-gradient(135deg, var(--ac-deep) 0%, var(--ac-mid) 60%, var(--ac-blue) 100%);
                padding: 0.6rem 0;
                box-shadow: 0 4px 20px rgba(30,15,117,0.18);
                position: sticky;
                top: 0;
                z-index: 1030;
            }
            .fo-navbar .navbar-brand {
                font-family: 'Sora', sans-serif;
                font-weight: 700;
                font-size: 1.35rem;
                color: #fff !important;
                letter-spacing: -0.5px;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }
            .fo-navbar .navbar-brand img { height: 32px; width: 32px; border-radius: 50%; }
            .fo-navbar .nav-link {
                color: rgba(255,255,255,0.82) !important;
                font-weight: 500;
                font-size: 0.92rem;
                padding: 0.5rem 0.85rem !important;
                border-radius: 8px;
                transition: all 0.2s;
            }
            .fo-navbar .nav-link:hover,
            .fo-navbar .nav-link.active {
                color: #fff !important;
                background: rgba(255,255,255,0.12);
            }
            .fo-navbar .nav-link i { margin-right: 0.35rem; }
            .fo-navbar .dropdown-menu {
                background: #fff;
                border: none;
                border-radius: 12px;
                box-shadow: 0 12px 32px rgba(30,15,117,0.18);
                padding: 0.5rem;
                min-width: 200px;
                margin-top: 0.4rem;
            }
            .fo-navbar .dropdown-item {
                border-radius: 8px;
                padding: 0.55rem 0.85rem;
                font-size: 0.9rem;
                color: #333;
            }
            .fo-navbar .dropdown-item:hover { background: rgba(30,15,117,0.06); color: var(--ac-deep); }
            .fo-navbar .dropdown-item i { width: 20px; text-align: center; margin-right: 0.4rem; color: var(--ac-mid); }
            .fo-navbar .dropdown-divider { margin: 0.3rem 0.5rem; border-color: rgba(30,15,117,0.1); }
            .fo-navbar .navbar-toggler { border-color: rgba(255,255,255,0.3); color: #fff; }
            .fo-navbar .navbar-toggler-icon { filter: invert(1); }

            .fo-user-badge {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                color: #fff;
                padding: 0.3rem 0.6rem;
                border-radius: 24px;
                background: rgba(255,255,255,0.1);
                cursor: pointer;
                text-decoration: none;
                transition: background 0.2s;
            }
            .fo-user-badge:hover { background: rgba(255,255,255,0.18); color: #fff; }
            .fo-user-avatar {
                width: 30px; height: 30px;
                border-radius: 50%;
                background: linear-gradient(135deg, var(--ac-lavender), var(--ac-blue));
                display: flex; align-items: center; justify-content: center;
                font-weight: 700; font-size: 0.8rem; color: #fff;
            }
            .fo-user-name { font-weight: 600; font-size: 0.85rem; }
            .fo-user-role { font-size: 0.65rem; text-transform: uppercase; opacity: 0.7; letter-spacing: 0.5px; }

            .fo-content {
                flex: 1;
                background: #f4f6fb;
                min-height: 0;
            }
            .fo-content > .container-xl { padding-top: 1.5rem; padding-bottom: 2rem; }

            /* ===== FRONTOFFICE FOOTER ===== */
            .fo-footer { background: var(--ac-deep); color: rgba(255,255,255,.7); padding: 3rem 0 1.5rem; }
            .fo-footer-brand { font-family:'Sora',sans-serif; font-weight:700; font-size:1.3rem; color:#fff; margin-bottom:.6rem; }
            .fo-footer-brand i { color:var(--ac-lavender); margin-right:.3rem; }
            .fo-footer-desc { font-size:.85rem; line-height:1.6; margin-bottom:1rem; }
            .fo-footer-social { display:flex; gap:.6rem; }
            .fo-footer-social a { width:34px; height:34px; border-radius:50%; background:rgba(255,255,255,.1); display:flex; align-items:center; justify-content:center; color:rgba(255,255,255,.7); font-size:.85rem; transition:all .2s; text-decoration:none; }
            .fo-footer-social a:hover { background:var(--ac-lavender); color:#fff; transform:translateY(-2px); }
            .fo-footer-title { font-family:'Sora',sans-serif; font-weight:700; font-size:.88rem; color:#fff; margin-bottom:.8rem; text-transform:uppercase; letter-spacing:.04em; }
            .fo-footer-links { list-style:none; padding:0; margin:0; }
            .fo-footer-links li { margin-bottom:.4rem; }
            .fo-footer-links a { color:rgba(255,255,255,.65); text-decoration:none; font-size:.85rem; transition:color .2s; }
            .fo-footer-links a:hover { color:#fff; }
            .fo-footer-contact-info p { font-size:.85rem; margin-bottom:.4rem; }
            .fo-footer-contact-info i { width:18px; color:var(--ac-lavender); margin-right:.4rem; font-size:.8rem; }
            .fo-footer-contact-btn { background:rgba(255,255,255,.1); color:#fff; border:1.5px solid rgba(255,255,255,.2); border-radius:10px; font-size:.84rem; font-weight:600; padding:.45rem 1.2rem; margin-top:.6rem; transition:all .2s; }
            .fo-footer-contact-btn:hover { background:var(--ac-lavender); border-color:var(--ac-lavender); color:#fff; transform:translateY(-1px); }
            .fo-footer-hr { border-color:rgba(255,255,255,.12); margin:1.5rem 0 1rem; }

            /* ===== GUEST ===== */
            .guest-nav { background: #fff; }
            .guest-brand {
                font-family: 'Sora', sans-serif;
                font-weight: 700;
                color: var(--ac-deep) !important;
            }
        </style>

        {% block stylesheets %}{% endblock %}

        {% block javascripts %}
            {% block importmap %}{{ importmap('app') }}{% endblock %}
        {% endblock %}
    </head>

    {# ---- Determine layout mode ---- #}
    {% set layout = not app.user ? 'guest' : (is_granted('ROLE_ADMIN') ? 'admin' : 'front') %}

    <body class="{{ layout == 'guest' ? 'front-mode' : (layout == 'admin' ? 'back-mode' : 'fo-mode') }}">

    {# =============================================================== #}
    {# OPENING WRAPPERS ‚Äî each branch opens tags, closed after body    #}
    {# =============================================================== #}

    {% if layout == 'guest' %}
        {% block guest_wrapper_open %}
        <nav class="navbar navbar-expand-lg navbar-light guest-nav mb-4 shadow-sm">
            <div class="container public-shell">
                <a class="navbar-brand guest-brand" href="{{ path('home') }}">ART CONNECT</a>
                <div class="d-flex">
                    <a href="{{ path('login') }}" class="btn btn-outline-primary me-2">Connexion</a>
                    <a href="{{ path('register') }}" class="btn btn-primary">Inscription</a>
                </div>
            </div>
        </nav>
        <div class="container public-shell">
        {% endblock %}

    {% elseif layout == 'admin' %}
        <div class="bo-wrapper">
            <nav id="sidebar">
                <div class="sidebar-header">
                    <img src="{{ asset('images/logo.png') }}" alt="Logo" class="img-fluid">
                    <h3>ART CONNECT</h3>
                </div>

                <ul class="list-unstyled components flex-grow-1">
                    <li><a href="{{ path('admin_dashboard') }}"><i class="fas fa-tachometer-alt me-2"></i> Dashboard</a></li>
                    <li><a href="{{ path('admin_stats') }}"><i class="fas fa-chart-bar me-2"></i> Statistiques</a></li>
                    <li><a href="{{ path('app_user_index') }}"><i class="fas fa-users me-2"></i> Utilisateurs</a></li>
                    <li><a href="{{ path('app_evenement_index') }}"><i class="fas fa-calendar-alt me-2"></i> √âv√©nements</a></li>
                    <li><a href="{{ path('app_reservation_my') }}"><i class="fas fa-ticket-alt me-2"></i> R√©servations</a></li>
                    <li><a href="{{ path('app_produit_admin_index') }}"><i class="fas fa-box me-2"></i> Produits</a></li>
                    <li><a href="{{ path('app_commande_index') }}"><i class="fas fa-shopping-cart me-2"></i> Commandes</a></li>
                    <li><a href="{{ path('app_donation_index') }}"><i class="fas fa-hand-holding-heart me-2"></i> Dons</a></li>
                    <li><a href="{{ path('app_type_don_index') }}"><i class="fas fa-tags me-2"></i> Types de Don</a></li>
                    <li><a href="{{ path('app_forum_index') }}"><i class="fas fa-comments me-2"></i> Forum</a></li>
                    <li><a href="{{ path('app_forum_reponse_index') }}"><i class="fas fa-reply me-2"></i> R√©ponses Forum</a></li>
                </ul>

                <div class="p-3 border-top border-secondary">
                    <div class="d-flex align-items-center mb-2">
                        <div class="flex-shrink-0">
                            <i class="fas fa-user-circle fa-2x text-light"></i>
                        </div>
                        <div class="flex-grow-1 ms-3 overflow-hidden">
                            <h6 class="mb-0 text-truncate" title="{{ app.user.prenom }} {{ app.user.nom }}">
                                {{ app.user.prenom }} {{ app.user.nom }}
                            </h6>
                            <small class="text-uppercase" style="font-size: 0.7rem;">ADMIN</small>
                        </div>
                    </div>
                    <a href="{{ path('logout') }}" class="btn btn-outline-danger btn-sm w-100">
                        <i class="fas fa-sign-out-alt me-1"></i> D√©connexion
                    </a>
                </div>
            </nav>

            <div class="bo-content">
                <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm rounded mb-4 d-md-none">
                    <div class="container-fluid">
                        <button type="button" id="sidebarCollapse" class="btn btn-primary">
                            <i class="fas fa-bars"></i>
                        </button>
                    </div>
                </nav>

    {% else %}
        <nav class="navbar navbar-expand-lg fo-navbar">
            <div class="container-xl">
                <a class="navbar-brand" href="{{ path('home') }}">
                    <img src="{{ asset('images/logo.png') }}" alt="Logo">
                    ART CONNECT
                </a>

                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#foNav">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="foNav">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link" href="{{ path('home') }}"><i class="fas fa-home"></i> Accueil</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ path('app_evenement_index') }}"><i class="fas fa-calendar-alt"></i> √âv√©nements</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ path('app_produit_index') }}"><i class="fas fa-store"></i> Boutique</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ path('app_donation_new') }}"><i class="fas fa-hand-holding-heart"></i> Faire un Don</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ path('app_forum_index') }}"><i class="fas fa-comments"></i> Forum</a>
                        </li>
                        {% if is_granted('ROLE_ARTISTE') %}
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">
                                    <i class="fas fa-paint-brush"></i> Gestion
                                </a>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="{{ path('app_evenement_new') }}"><i class="fas fa-plus-circle"></i> Cr√©er un √âv√©nement</a></li>
                                    <li><a class="dropdown-item" href="{{ path('app_produit_admin_index') }}"><i class="fas fa-box"></i> Mes Produits</a></li>
                                    <li><a class="dropdown-item" href="{{ path('app_commande_index') }}"><i class="fas fa-shopping-cart"></i> Commandes re√ßues</a></li>
                                </ul>
                            </li>
                        {% endif %}
                    </ul>

                    <ul class="navbar-nav">
                        <li class="nav-item dropdown">
                            <a class="fo-user-badge dropdown-toggle" href="#" data-bs-toggle="dropdown" data-bs-auto-close="outside">
                                <div class="fo-user-avatar">
                                    {{ app.user.prenom|first|upper }}{{ app.user.nom|first|upper }}
                                </div>
                                <div class="d-none d-lg-block">
                                    <div class="fo-user-name">{{ app.user.prenom }} {{ app.user.nom }}</div>
                                    <div class="fo-user-role">
                                        {% if is_granted('ROLE_ARTISTE') %}Artiste{% else %}Participant{% endif %}
                                    </div>
                                </div>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li>
                                    <a class="dropdown-item" href="{{ is_granted('ROLE_ARTISTE') ? path('artist_profile') : path('participant_profile') }}">
                                        <i class="fas fa-user"></i> Mon Profil
                                    </a>
                                </li>
                                <li><a class="dropdown-item" href="{{ path('app_reservation_my') }}"><i class="fas fa-ticket-alt"></i> Mes R√©servations</a></li>
                                <li><a class="dropdown-item" href="{{ path('app_commande_my') }}"><i class="fas fa-shopping-bag"></i> Mes Commandes</a></li>
                                <li><a class="dropdown-item" href="{{ path('app_donation_my') }}"><i class="fas fa-heart"></i> Mes Dons</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item text-danger" href="{{ path('logout') }}">
                                        <i class="fas fa-sign-out-alt"></i> D√©connexion
                                    </a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <main class="fo-content">
            <div class="container-xl">

    {% endif %}

    {# =============================================================== #}
    {# BODY ‚Äî flash messages handled by global toast system            #}
    {# =============================================================== #}

    {% block body %}{% endblock %}

    {# =============================================================== #}
    {# CLOSING WRAPPERS ‚Äî mirror the opening tags                      #}
    {# =============================================================== #}

    {% if layout == 'guest' %}
        {% block guest_wrapper_close %}
        </div>{# /.container.public-shell #}

        <footer class="fo-footer">
            <div class="container-xl">
                <div class="row gy-4">
                    <div class="col-lg-4">
                        <div class="fo-footer-brand">
                            <i class="fas fa-palette"></i> Art Connect
                        </div>
                        <p class="fo-footer-desc">Plateforme d'art inclusif d√©di√©e aux enfants. Nous croyons que chaque enfant m√©rite d'explorer sa cr√©ativit√©.</p>
                        <div class="fo-footer-social">
                            <a href="#"><i class="fab fa-facebook-f"></i></a>
                            <a href="#"><i class="fab fa-instagram"></i></a>
                            <a href="#"><i class="fab fa-youtube"></i></a>
                            <a href="#"><i class="fab fa-linkedin-in"></i></a>
                        </div>
                    </div>

                    <div class="col-6 col-lg-2">
                        <h6 class="fo-footer-title">D√©couvrir</h6>
                        <ul class="fo-footer-links">
                            <li><a href="{{ path('home') }}">Accueil</a></li>
                            <li><a href="{{ path('login') }}">Connexion</a></li>
                            <li><a href="{{ path('register') }}">Inscription</a></li>
                        </ul>
                    </div>

                    <div class="col-6 col-lg-2">
                        <h6 class="fo-footer-title">La Plateforme</h6>
                        <ul class="fo-footer-links">
                            <li><a href="#">√âv√©nements</a></li>
                            <li><a href="#">Boutique</a></li>
                            <li><a href="#">Forum</a></li>
                        </ul>
                    </div>

                    <div class="col-lg-4">
                        <h6 class="fo-footer-title">Contactez-nous</h6>
                        <div class="fo-footer-contact-info">
                            <p><i class="fas fa-map-marker-alt"></i> Tunis, Tunisie</p>
                            <p><i class="fas fa-envelope"></i> contact@artconnect.tn</p>
                            <p><i class="fas fa-phone"></i> +216 71 000 000</p>
                        </div>
                        <button class="btn fo-footer-contact-btn" data-bs-toggle="modal" data-bs-target="#contactModal">
                            <i class="fas fa-paper-plane me-1"></i> Envoyer un message
                        </button>
                    </div>
                </div>

                <hr class="fo-footer-hr">
                <div class="d-flex flex-column flex-md-row justify-content-between align-items-center gap-2">
                    <small>&copy; {{ "now"|date("Y") }} Art Connect. Tous droits r√©serv√©s.</small>
                    <small>Fait avec <i class="fas fa-heart" style="color:var(--ac-pink);"></i> pour l'inclusion</small>
                </div>
            </div>
        </footer>

        {# ---- Contact Modal (guest) ---- #}
        <div class="modal fade" id="contactModal" tabindex="-1" aria-labelledby="contactModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content" style="border:none; border-radius:16px; overflow:hidden;">
                    <div class="modal-header" style="background:linear-gradient(135deg,var(--ac-deep),var(--ac-mid)); color:#fff; border:none; padding:1.2rem 1.5rem;">
                        <h5 class="modal-title" id="contactModalLabel" style="font-family:'Sora',sans-serif; font-weight:700; font-size:1.1rem;">
                            <i class="fas fa-envelope me-2"></i>Nous contacter
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fermer"></button>
                    </div>
                    <div class="modal-body" style="padding:1.5rem;">
                        <form id="contactFormGuest">
                            <div class="mb-3">
                                <label class="form-label fw-semibold" style="font-size:.85rem;">Votre email</label>
                                <input type="email" class="form-control" placeholder="votre@email.com" style="border-radius:10px; font-size:.88rem; border:1.5px solid #e5e7eb; padding:.5rem .8rem;" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-semibold" style="font-size:.85rem;">Sujet</label>
                                <input type="text" class="form-control" placeholder="Objet de votre message" style="border-radius:10px; font-size:.88rem; border:1.5px solid #e5e7eb; padding:.5rem .8rem;" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-semibold" style="font-size:.85rem;">Message</label>
                                <textarea class="form-control" rows="4" placeholder="√âcrivez votre message ici..." style="border-radius:10px; font-size:.88rem; border:1.5px solid #e5e7eb; padding:.6rem .8rem; resize:vertical;" required></textarea>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn" style="background:linear-gradient(135deg,var(--ac-deep),var(--ac-mid)); color:#fff; border:none; border-radius:10px; font-weight:700; font-size:.9rem; padding:.6rem;">
                                    Envoyer <i class="fas fa-paper-plane ms-1"></i>
                                </button>
                            </div>
                        </form>
                        <div id="contactSuccessGuest" class="text-center d-none" style="padding:2rem 0;">
                            <i class="fas fa-check-circle" style="font-size:2.5rem; color:#22c55e;"></i>
                            <p class="mt-2 mb-0 fw-semibold" style="color:#374151;">Message envoy√© avec succ√®s !</p>
                            <small class="text-muted">Nous vous r√©pondrons dans les plus brefs d√©lais.</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endblock %}

    {% elseif layout == 'admin' %}
            </div>{# /.bo-content #}
        </div>{# /.bo-wrapper #}

    {% else %}
            </div>{# /.container-xl #}
        </main>

        <footer class="fo-footer">
            <div class="container-xl">
                <div class="row gy-4">
                    <div class="col-lg-4">
                        <div class="fo-footer-brand">
                            <i class="fas fa-palette"></i> Art Connect
                        </div>
                        <p class="fo-footer-desc">Plateforme d'art inclusif d√©di√©e aux enfants. Nous croyons que chaque enfant m√©rite d'explorer sa cr√©ativit√©.</p>
                        <div class="fo-footer-social">
                            <a href="#"><i class="fab fa-facebook-f"></i></a>
                            <a href="#"><i class="fab fa-instagram"></i></a>
                            <a href="#"><i class="fab fa-youtube"></i></a>
                            <a href="#"><i class="fab fa-linkedin-in"></i></a>
                        </div>
                    </div>

                    <div class="col-6 col-lg-2">
                        <h6 class="fo-footer-title">Navigation</h6>
                        <ul class="fo-footer-links">
                            <li><a href="{{ path('home') }}">Accueil</a></li>
                            <li><a href="{{ path('app_evenement_index') }}">√âv√©nements</a></li>
                            <li><a href="{{ path('app_produit_index') }}">Boutique</a></li>
                            <li><a href="{{ path('app_forum_index') }}">Forum</a></li>
                        </ul>
                    </div>

                    <div class="col-6 col-lg-2">
                        <h6 class="fo-footer-title">Mon Compte</h6>
                        <ul class="fo-footer-links">
                            <li><a href="{{ path('app_reservation_my') }}">R√©servations</a></li>
                            <li><a href="{{ path('app_commande_my') }}">Commandes</a></li>
                            <li><a href="{{ path('app_donation_my') }}">Mes Dons</a></li>
                            <li><a href="{{ path('app_donation_new') }}">Faire un Don</a></li>
                        </ul>
                    </div>

                    <div class="col-lg-4">
                        <h6 class="fo-footer-title">Contactez-nous</h6>
                        <div class="fo-footer-contact-info">
                            <p><i class="fas fa-map-marker-alt"></i> Tunis, Tunisie</p>
                            <p><i class="fas fa-envelope"></i> contact@artconnect.tn</p>
                            <p><i class="fas fa-phone"></i> +216 71 000 000</p>
                        </div>
                        <button class="btn fo-footer-contact-btn" data-bs-toggle="modal" data-bs-target="#contactModal">
                            <i class="fas fa-paper-plane me-1"></i> Envoyer un message
                        </button>
                    </div>
                </div>

                <hr class="fo-footer-hr">
                <div class="d-flex flex-column flex-md-row justify-content-between align-items-center gap-2">
                    <small>&copy; {{ "now"|date("Y") }} Art Connect. Tous droits r√©serv√©s.</small>
                    <small>Fait avec <i class="fas fa-heart" style="color:var(--ac-pink);"></i> pour l'inclusion</small>
                </div>
            </div>
        </footer>

        {# ---- Contact Modal ---- #}
        <div class="modal fade" id="contactModal" tabindex="-1" aria-labelledby="contactModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content" style="border:none; border-radius:16px; overflow:hidden;">
                    <div class="modal-header" style="background:linear-gradient(135deg,var(--ac-deep),var(--ac-mid)); color:#fff; border:none; padding:1.2rem 1.5rem;">
                        <h5 class="modal-title" id="contactModalLabel" style="font-family:'Sora',sans-serif; font-weight:700; font-size:1.1rem;">
                            <i class="fas fa-envelope me-2"></i>Nous contacter
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fermer"></button>
                    </div>
                    <div class="modal-body" style="padding:1.5rem;">
                        <form id="contactForm">
                            <div class="mb-3">
                                <label class="form-label fw-semibold" style="font-size:.85rem;">Sujet</label>
                                <input type="text" class="form-control" placeholder="Objet de votre message" style="border-radius:10px; font-size:.88rem; border:1.5px solid #e5e7eb; padding:.5rem .8rem;" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-semibold" style="font-size:.85rem;">Message</label>
                                <textarea class="form-control" rows="4" placeholder="√âcrivez votre message ici..." style="border-radius:10px; font-size:.88rem; border:1.5px solid #e5e7eb; padding:.6rem .8rem; resize:vertical;" required></textarea>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn" style="background:linear-gradient(135deg,var(--ac-deep),var(--ac-mid)); color:#fff; border:none; border-radius:10px; font-weight:700; font-size:.9rem; padding:.6rem;">
                                    Envoyer <i class="fas fa-paper-plane ms-1"></i>
                                </button>
                            </div>
                        </form>
                        <div id="contactSuccess" class="text-center d-none" style="padding:2rem 0;">
                            <i class="fas fa-check-circle" style="font-size:2.5rem; color:#22c55e;"></i>
                            <p class="mt-2 mb-0 fw-semibold" style="color:#374151;">Message envoy√© avec succ√®s !</p>
                            <small class="text-muted">Nous vous r√©pondrons dans les plus brefs d√©lais.</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    {% endif %}

    {# =============================================================== #}
    {# SCRIPTS                                                          #}
    {# =============================================================== #}

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    {% if layout == 'admin' %}
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                var btn = document.getElementById('sidebarCollapse');
                var sb  = document.getElementById('sidebar');
                if (btn) btn.addEventListener('click', function() { sb.classList.toggle('active'); });

                var cur = window.location.href;
                document.querySelectorAll('#sidebar li').forEach(function(li) { li.classList.remove('active'); });
                document.querySelectorAll('#sidebar a[href]').forEach(function(a) {
                    var h = a.getAttribute('href');
                    if (cur.includes(h) && h !== '/') a.parentElement.classList.add('active');
                });
            });
        </script>
    {% elseif layout == 'front' %}
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                var cur = window.location.pathname;
                document.querySelectorAll('.fo-navbar .nav-link').forEach(function(a) {
                    var h = new URL(a.href, window.location.origin).pathname;
                    if (h !== '/' && cur.startsWith(h)) a.classList.add('active');
                    else if (h === '/' && cur === '/') a.classList.add('active');
                });

                var cf = document.getElementById('contactForm');
                var cs = document.getElementById('contactSuccess');
                if (cf) {
                    cf.addEventListener('submit', function(e) {
                        e.preventDefault();
                        cf.classList.add('d-none');
                        cs.classList.remove('d-none');
                    });
                }
                var cm = document.getElementById('contactModal');
                if (cm) {
                    cm.addEventListener('hidden.bs.modal', function() {
                        cf.reset();
                        cf.classList.remove('d-none');
                        cs.classList.add('d-none');
                    });
                }
            });
        </script>
    {% endif %}

    {% if layout == 'guest' %}
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                var cf = document.getElementById('contactFormGuest');
                var cs = document.getElementById('contactSuccessGuest');
                if (cf) {
                    cf.addEventListener('submit', function(e) {
                        e.preventDefault();
                        cf.classList.add('d-none');
                        cs.classList.remove('d-none');
                    });
                }
                var cm = document.getElementById('contactModal');
                if (cm) {
                    cm.addEventListener('hidden.bs.modal', function() {
                        cf.reset();
                        cf.classList.remove('d-none');
                        cs.classList.add('d-none');
                    });
                }
            });
        </script>
    {% endif %}

    {# ===== GLOBAL TOAST NOTIFICATIONS ===== #}
    <div id="toast-container" aria-live="polite" aria-atomic="true" style="position:fixed;top:1.2rem;right:1.2rem;z-index:9999;display:flex;flex-direction:column;gap:.5rem;max-width:400px;">
        {% for type in ['success','danger','warning','info'] %}
            {% for flash in app.flashes(type) %}
                <div class="ac-toast ac-toast-{{ type }}" role="alert">
                    <div class="ac-toast-icon">
                        {% if type == 'success' %}<i class="fas fa-check-circle"></i>
                        {% elseif type == 'danger' %}<i class="fas fa-exclamation-circle"></i>
                        {% elseif type == 'warning' %}<i class="fas fa-exclamation-triangle"></i>
                        {% else %}<i class="fas fa-info-circle"></i>{% endif %}
                    </div>
                    <div class="ac-toast-body">{{ flash }}</div>
                    <button class="ac-toast-close" onclick="this.parentElement.remove()"><i class="fas fa-times"></i></button>
                    <div class="ac-toast-progress"></div>
                </div>
            {% endfor %}
        {% endfor %}
    </div>
    <style>
        .ac-toast{display:flex;align-items:flex-start;gap:.6rem;padding:.7rem 1rem;border-radius:12px;background:#fff;box-shadow:0 8px 30px rgba(0,0,0,.12);border-left:4px solid #6b7280;position:relative;overflow:hidden;animation:toastIn .35s ease-out;min-width:280px;}
        .ac-toast-success{border-left-color:#059669;}.ac-toast-danger{border-left-color:#dc2626;}.ac-toast-warning{border-left-color:#d97706;}.ac-toast-info{border-left-color:#2563eb;}
        .ac-toast-icon{font-size:1rem;margin-top:1px;flex-shrink:0;}
        .ac-toast-success .ac-toast-icon{color:#059669;}.ac-toast-danger .ac-toast-icon{color:#dc2626;}.ac-toast-warning .ac-toast-icon{color:#d97706;}.ac-toast-info .ac-toast-icon{color:#2563eb;}
        .ac-toast-body{flex:1;font-size:.84rem;color:#1f2937;line-height:1.4;font-weight:500;}
        .ac-toast-close{background:none;border:none;color:#9ca3af;cursor:pointer;padding:0;font-size:.75rem;flex-shrink:0;margin-top:1px;transition:color .2s;}.ac-toast-close:hover{color:#374151;}
        .ac-toast-progress{position:absolute;bottom:0;left:0;height:3px;border-radius:0 0 0 12px;animation:toastTimer 5s linear forwards;}
        .ac-toast-success .ac-toast-progress{background:#059669;}.ac-toast-danger .ac-toast-progress{background:#dc2626;}.ac-toast-warning .ac-toast-progress{background:#d97706;}.ac-toast-info .ac-toast-progress{background:#2563eb;}
        @keyframes toastIn{from{opacity:0;transform:translateX(40px);}to{opacity:1;transform:translateX(0);}}
        @keyframes toastOut{from{opacity:1;transform:translateX(0);}to{opacity:0;transform:translateX(40px);}}
        @keyframes toastTimer{from{width:100%;}to{width:0;}}
    </style>
    <script>
        document.addEventListener('DOMContentLoaded',function(){
            document.querySelectorAll('.ac-toast').forEach(function(t,i){
                t.style.animationDelay=(i*80)+'ms';
                setTimeout(function(){
                    t.style.animation='toastOut .3s ease-in forwards';
                    setTimeout(function(){t.remove();},300);
                },5000+i*200);
            });
        });
    </script>

    </body>
</html>
